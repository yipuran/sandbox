
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.UnsupportedEncodingException;
import java.net.URISyntaxException;
import java.nio.charset.StandardCharsets;
import java.util.stream.Stream;

import org.labo.featurestream.StreamExtra;
import org.yipuran.function.ThrowableConsumer;
import org.yipuran.function.ThrowablePredicate;

import com.google.gson.stream.JsonReader;
import com.google.gson.stream.JsonToken;


public class GsonReadTest{

   public static void main(String[] args) {
      try{
         File file = new File(new File(ClassLoader.getSystemClassLoader().getResource("./").toURI()).getAbsolutePath()+"/test.json");
         parse(file.getAbsolutePath());
      }catch(URISyntaxException e){
         e.printStackTrace();
      }

//      parse(jsonFilePath);

   }
  public static void parse(String jsonFilePath){
      try(JsonReader jsonReader = new JsonReader(
              new InputStreamReader(
                      new FileInputStream(jsonFilePath), StandardCharsets.UTF_8))) {
//          jsonReader.beginObject();
          //

//          while (jsonReader.hasNext()) {
//              JsonToken token = jsonReader.peek();
//              switch (token) {
//               case BEGIN_ARRAY:
//                   jsonReader.beginArray();
//                   System.out.println("BEGIN_ARRAY");
//                   break;
//               case END_ARRAY:
//                   jsonReader.endArray();
//                   System.out.println("END_ARRAY");
//                   break;
//               case BEGIN_OBJECT:
//                   jsonReader.beginObject();
//                  System.out.println("BEGIN_OBJECT");
//
//
//                  String name2 = jsonReader.nextName();
//                   System.out.println("name2 = "+name2);
//
//                   break;
//               case END_OBJECT:
//                   jsonReader.endObject();
//                  System.out.println("END_OBJECT");
//                   break;
//               case NAME:
//                   String name = jsonReader.nextName();
//                   System.out.println("name = "+name);
//                   break;
//               case STRING:
//                   String s = jsonReader.nextString();
//                   System.out.println("s = "+s);
//                   break;
//               case NUMBER:
//                   String n = jsonReader.nextString();
//                   System.out.println("n = "+n);
//                   break;
//               case BOOLEAN:
//                   boolean b = jsonReader.nextBoolean();
//                   System.out.println("b = "+b);
//                   break;
//               case NULL:
//                   jsonReader.nextNull();
//                   System.out.println("NULL");
//                   break;
//               case END_DOCUMENT:
//                  System.out.println("END_DOCUMENT");
//                   return;
//              }
//
//          }

          StreamExtra.whilestream(Stream.iterate(jsonReader, r->r),  ThrowablePredicate.of(r->r.hasNext())).forEach(
                ThrowableConsumer.of(
                r->{
             JsonToken token = r.peek();
             switch (token) {
                 case BEGIN_ARRAY:
                     r.beginArray();
                     System.out.println("BEGIN_ARRAY");
                     break;
                 case END_ARRAY:
                     r.endArray();
                     System.out.println("END_ARRAY");
                     break;
                 case BEGIN_OBJECT:
                     r.beginObject();
                    System.out.println("BEGIN_OBJECT");


                    String name2 = r.nextName();
                     System.out.println("name2 = "+name2);

                     break;
                 case END_OBJECT:
                     r.endObject();
                    System.out.println("END_OBJECT");
                     break;
                 case NAME:
                     String name = r.nextName();
                     System.out.println("name = "+name);
                     break;
                 case STRING:
                     String s = r.nextString();
                     System.out.println("s = "+s);
                     break;
                 case NUMBER:
                     String n = r.nextString();
                     System.out.println("n = "+n);
                     break;
                 case BOOLEAN:
                     boolean b = r.nextBoolean();
                     System.out.println("b = "+b);
                     break;
                 case NULL:
                     r.nextNull();
                     System.out.println("NULL");
                     break;
                 case END_DOCUMENT:
                    System.out.println("END_DOCUMENT");
                     return;
             }

          }));

          ///
          //jsonReader.endObject();
          jsonReader.close();

      }
      catch (UnsupportedEncodingException e) {
          e.printStackTrace();
      } catch (FileNotFoundException e) {
          e.printStackTrace();
      } catch (IOException e) {
          e.printStackTrace();
      }
  }

}